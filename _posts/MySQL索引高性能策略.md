---
title: MySQL索引高性能策略
date: 2017-02-03 16:24:07
categories: MySQL
---
摘自《高性能MySQL》第5章 创建高性能的索引。<!-- more -->

## 索引基础
索引（在MySQL中也叫做键key）是存储引擎用于快速找到记录的一种数据结构。索引对于良好的性能非常关键。尤其是当表中的数据量越来越大时，索引对性能的影响愈发重要。“最优”的索引有时比“好的”索引性能要好两个数量级。

索引可以包含一个或多个列的值。如果索引包含多个列，那么列的顺序也十分重要，因为MySQL只能高效地使用最左前缀列，创建一个包含两个列的索引，和创建两个只包含一个列的索引是大不相同的。

## 索引的类型
在MySQL中，索引是在存储引擎层而不是服务器层实现的。所以，并没有统一的索引标准：不同存储引擎的索引的工作方式并不一样，也不是所有的存储引擎都支持所有类型的索引。

### B-Tree索引
当人们谈论索引的时候，如果没有特别指明类型，多半说的是B-Tree索引，它使用B-Tree数据结构来存储数据。不过底层的存储引擎也可能使用不同的存储结构，例如NDB群集存储引擎内部实际上使用了T-Tree结构存储索引；InnoDB则使用的是B+Tree。

存储引擎以不同的方式使用B-Tree索引，性能也各有不同，各有优劣。例如MyISAM使用前缀压缩技术使得索引更小，但InnoDB则按照原数据格式进行存储。

B-Tree通常意味着所有的值都是按顺序存储的，并且每一个叶子节点到根节点的距离相同。

B-Tree索引能加快访问数据的速度，因为存储引擎不再需要进行全表扫描来获取需要的数据，取而代之的是从索引的根节点开始进行搜索。根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下层查找。通过比较节点中的值和需要查找的值，找到合适的指针进入下层子节点。这些指针实际上定义了子节点中值的上限和下限。最终存储引擎要么是找到对应的值，要么是得出该值的记录不存在。

叶子节点比较特别，它们的指针指向的是被索引的数据，而不是其它的节点。数的深度和表的大小直接相关。

B-Tree对索引列是顺序组织存储的，所以很适合查找范围数据。例如，在一个基于文本域的索引树上，按字母顺序连续传递的值进行查找是非常合适的。索引对多个值进行排序的依据是CREATE TABLE语句中定义索引时列的顺序。

#### B-Tree索引的查询类型
B-Tree索引适用于全键值、键值范围或键前缀查找。其中键前缀查找只适用于根据最左前缀的查找。前面所述的索引对如下类型的查询有效：
* 全值匹配
* 匹配最左前缀
* 匹配列前缀
* 匹配范围值
* 精确匹配某一列并范围匹配另一列
* 只访问索引的查询

因为索引树中的节点是有序的，所以除了按值查找之外，索引还可以用于ORDER BY操作。一般来说，如果B-Tree可以按照某种方式查找到值，那么也可以按照这种方式用于排序。所以如果ORDER BY子句满足前面列出的几种查询类型，则这个索引也可以满足对应的排序需求。

#### B-Tree索引的限制
以下是一些关于B-Tree索引的限制：
* 如果不是按照索引的最左列开始查找，则无法使用索引。
* 不能跳过索引中的列。
* 如果查询中有某个列的范围查询，则其右边所有列都无法使用索引优化查询。

索引列的顺序至关重要，这些限制都和索引列的顺序有关。在优化性能的时候，可能需要使用相同的列但顺序不同的索引来满足不同类型的查询需求。

### 哈希索引

### 空间数据索引（R-Tree）

### 全文索引

### 其它索引类别

## 高性能的索引策略

### 独立的列

### 前缀索引和索引选择性

### 多列索引

### 选择合适的索引列顺序

### 聚簇索引

### 覆盖索引

### 使用索引扫描来做排序

### 压缩（前缀压缩）索引

### 冗余和重复索引

### 未使用的索引

### 索引和锁

## 总结

B+Tree数据结构
InnoDB、MyISAM的B+Tree实现
MySQL使用索引
索引的选择性和索引前缀
主键auto_increment
