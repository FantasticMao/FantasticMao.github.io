<!DOCTYPE html>
<html lang="zh-cn">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="FantasticMao">
    <meta name="description" content="Docker Compose 是用于定义和运行多个 Docker Container 的工具。Docker 官方在 《Get started with Docker Compose》 文档中，以创建一个基于 Flask 和 Redis 的 Python web 应用，为 Docker 新手提供了一个用于学习和实践 Docker Compose 的简单案例。
SpringBoot-RocketMQ-Docker 使用 Docker Compose，创建了一个基于 Spring Boot 和 Apache RocketMQ 的 Java web 应用，旨在提供更适用于 Java 相关开发人员的 Docker Compose 实践案例。">
    <meta name="keywords" content="Java,Docker,Docker Compose,Spring Boot,Apache RocketMQ">


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker Compose 的 Java 版实践"/>
<meta name="twitter:description" content="Docker Compose 是用于定义和运行多个 Docker Container 的工具。Docker 官方在 《Get started with Docker Compose》 文档中，以创建一个基于 Flask 和 Redis 的 Python web 应用，为 Docker 新手提供了一个用于学习和实践 Docker Compose 的简单案例。
SpringBoot-RocketMQ-Docker 使用 Docker Compose，创建了一个基于 Spring Boot 和 Apache RocketMQ 的 Java web 应用，旨在提供更适用于 Java 相关开发人员的 Docker Compose 实践案例。"/>

    <meta property="og:title" content="Docker Compose 的 Java 版实践" />
<meta property="og:description" content="Docker Compose 是用于定义和运行多个 Docker Container 的工具。Docker 官方在 《Get started with Docker Compose》 文档中，以创建一个基于 Flask 和 Redis 的 Python web 应用，为 Docker 新手提供了一个用于学习和实践 Docker Compose 的简单案例。
SpringBoot-RocketMQ-Docker 使用 Docker Compose，创建了一个基于 Spring Boot 和 Apache RocketMQ 的 Java web 应用，旨在提供更适用于 Java 相关开发人员的 Docker Compose 实践案例。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/docker-compose-%E7%9A%84-java-%E7%89%88%E5%AE%9E%E8%B7%B5/" />
<meta property="article:published_time" content="2020-03-18T10:55:02+08:00" />
<meta property="article:modified_time" content="2020-03-18T10:55:02+08:00" />


    
      <base href="/posts/docker-compose-%E7%9A%84-java-%E7%89%88%E5%AE%9E%E8%B7%B5/">
    
    <title>
  Docker Compose 的 Java 版实践 · FantasticMao&#39;s Blog
</title>

    
      <link rel="canonical" href="/posts/docker-compose-%E7%9A%84-java-%E7%89%88%E5%AE%9E%E8%B7%B5/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css" integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    

    <link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.68.3" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      FantasticMao&#39;s Blog
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/">首页</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/posts/">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories/">分类</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags/">标签</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/about/">关于</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Docker Compose 的 Java 版实践</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-03-18T10:55:02&#43;08:00'>
                March 18, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              4 分钟阅读时间
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="/tags/java/">Java</a>
      <span class="separator">•</span>
    <a href="/tags/docker/">Docker</a></div>

        </div>
      </header>

      <div>
        
        <p>Docker Compose 是用于定义和运行多个 Docker Container 的工具。Docker 官方在 <a href="https://docs.docker.com/compose/gettingstarted/">《Get started with Docker Compose》</a> 文档中，以创建一个基于 Flask 和 Redis 的 Python web 应用，为 Docker 新手提供了一个用于学习和实践 Docker Compose 的简单案例。</p>
<p><a href="https://github.com/FantasticMao/springboot-rocketmq-docker/">SpringBoot-RocketMQ-Docker</a> 使用 Docker Compose，创建了一个基于 Spring Boot 和 Apache RocketMQ 的 Java web 应用，旨在提供更适用于 Java 相关开发人员的 Docker Compose 实践案例。</p>
<p>SpringBoot-RocketMQ-Docker 的业务场景比较简单：<strong>MQ Producer 作为 REST Server，通过 HTTP 协议从客户端中接收消息，并经由 RocketMQ 发送给 MQ Consumer</strong>。消息在 SpringBoot-RocketMQ-Docker 中的流转过程如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">                +-------------+           +--------------+           +-------------+
                |             | --------&gt; | RocketMQ     | &lt;-------- |             |
                |             | discovery | NameServer   | discovery |             |
                |             |           +--------------+           |             |
      send msg  | MQ Producer |                A    A                | MQ Consumer |
 HTTP --------&gt; |     &amp;&amp;      |   routing info |    |                | (print msg) |
                | REST Server |                V    V                |             |
                |             |           +--------------+           |             |
                |             | send msg  | RocketMQ     | send msg  |             |
                |             | --------&gt; | BrokerServer | --------&gt; |             |
                +-------------+           +--------------+           +-------------+
</code></pre></div><hr>
<h2 id="前期准备">前期准备</h2>
<p>在开始创建应用之前，需要开发者安装 <a href="https://docs.docker.com/install/">Docker Engine</a> 和 <a href="https://docs.docker.com/compose/install/">Docker Compose</a>，以及在开发阶段用于管理依赖和打包项目的 Maven 与用于编译项目和调试代码的 JDK，但是无需安装在运行阶段必需的 JRE 和 RocketMQ，因为它们会由 Docker Image 提供。</p>
<hr>
<h2 id="创建应用">创建应用</h2>
<h3 id="创建工程">创建工程</h3>
<ol>
<li>
<p>创建工程目录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  $ mkdir springboot-rocketmq-docker
  $ cd springboot-rocketmq-docker
</code></pre></div></li>
<li>
<p>在工程根目录下，创建一个 <code>pom.xml</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;parent&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.2.2.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/parent&gt;</span>
    <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>

    <span style="color:#f92672">&lt;groupId&gt;</span>cn.fantasticmao.demo<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>springboot-rocketmq-docker<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;packaging&gt;</span>pom<span style="color:#f92672">&lt;/packaging&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>

    <span style="color:#f92672">&lt;modules&gt;</span>
        <span style="color:#f92672">&lt;module&gt;</span>mq-producer<span style="color:#f92672">&lt;/module&gt;</span>
        <span style="color:#f92672">&lt;module&gt;</span>mq-consumer<span style="color:#f92672">&lt;/module&gt;</span>
    <span style="color:#f92672">&lt;/modules&gt;</span>

    <span style="color:#f92672">&lt;build&gt;</span>
        <span style="color:#f92672">&lt;plugins&gt;</span>
            <span style="color:#f92672">&lt;plugin&gt;</span>
                <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
                <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;/plugin&gt;</span>
        <span style="color:#f92672">&lt;/plugins&gt;</span>
    <span style="color:#f92672">&lt;/build&gt;</span>

    <span style="color:#f92672">&lt;dependencyManagement&gt;</span>
        <span style="color:#f92672">&lt;dependencies&gt;</span>
            <span style="color:#f92672">&lt;dependency&gt;</span>
                <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.rocketmq<span style="color:#f92672">&lt;/groupId&gt;</span>
                <span style="color:#f92672">&lt;artifactId&gt;</span>rocketmq-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
                <span style="color:#f92672">&lt;version&gt;</span>2.1.0<span style="color:#f92672">&lt;/version&gt;</span>
            <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;/dependencies&gt;</span>
     <span style="color:#f92672">&lt;/dependencyManagement&gt;</span>
<span style="color:#f92672">&lt;/project&gt;</span>
</code></pre></div></li>
</ol>
<h3 id="创建模块-mq-producer">创建模块 mq-producer</h3>
<ol>
<li>
<p>在工程根目录下，创建模块 mq-producer 目录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> $ mkdir mq-producer
 $ cd mq-producer
</code></pre></div></li>
<li>
<p>在模块根目录下，创建一个 <code>pom.xml</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;parent&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>springboot-rocketmq-docker<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>cn.fantasticmao.demo<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/parent&gt;</span>
    <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>

    <span style="color:#f92672">&lt;artifactId&gt;</span>mq-producer<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;packaging&gt;</span>jar<span style="color:#f92672">&lt;/packaging&gt;</span>

    <span style="color:#f92672">&lt;dependencies&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.rocketmq<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>rocketmq-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;/dependencies&gt;</span>
<span style="color:#f92672">&lt;/project&gt;</span>
</code></pre></div></li>
<li>
<p>在模块目录下，创建 <code>src/main/java/cn/fantasticmao/demo/Producer.java</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> cn.fantasticmao.demo<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.apache.rocketmq.client.producer.SendResult<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.rocketmq.spring.core.RocketMQTemplate<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.annotation.Resource<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.nio.charset.StandardCharsets<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@RestController</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Resource</span>
    <span style="color:#66d9ef">private</span> RocketMQTemplate rocketMQTemplate<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/say/{msg}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">say</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span> String msg<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> payload <span style="color:#f92672">=</span> msg<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span>StandardCharsets<span style="color:#f92672">.</span><span style="color:#a6e22e">UTF_8</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">final</span> SendResult sendResult <span style="color:#f92672">=</span> rocketMQTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">syncSend</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;springboot-rocketmq-docker&#34;</span><span style="color:#f92672">,</span> payload<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Send MsgId: %s%n&#34;</span><span style="color:#f92672">,</span> sendResult<span style="color:#f92672">.</span><span style="color:#a6e22e">getMsgId</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@SpringBootApplication</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>Application<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>在模块目录下，创建 <code>src/main/resources/application.yml</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">rocketmq</span>:
  <span style="color:#66d9ef">name-server</span>: name-server:<span style="color:#ae81ff">9876</span>
  <span style="color:#66d9ef">producer</span>:
    <span style="color:#66d9ef">group</span>: producer
</code></pre></div></li>
</ol>
<h3 id="创建模块-mq-consumer">创建模块 mq-consumer</h3>
<ol>
<li>
<p>在工程根目录下，创建模块 mq-consumer 目录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> $ mkdir mq-consumer
 $ cd mq-consumer
</code></pre></div></li>
<li>
<p>在模块根目录下，创建一个 <code>pom.xml</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;parent&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>springboot-rocketmq-docker<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>cn.fantasticmao.demo<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/parent&gt;</span>
    <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>

    <span style="color:#f92672">&lt;artifactId&gt;</span>mq-consumer<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;packaging&gt;</span>jar<span style="color:#f92672">&lt;/packaging&gt;</span>

    <span style="color:#f92672">&lt;dependencies&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.rocketmq<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>rocketmq-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;/dependencies&gt;</span>
<span style="color:#f92672">&lt;/project&gt;</span>
</code></pre></div></li>
<li>
<p>在模块目录下，创建 <code>src/main/java/cn/fantasticmao/demo/Consumer.java</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> cn.fantasticmao.demo<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.apache.rocketmq.common.message.MessageExt<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.rocketmq.spring.annotation.RocketMQMessageListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.rocketmq.spring.core.RocketMQListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.stereotype.Service<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.nio.charset.StandardCharsets<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Service</span>
<span style="color:#a6e22e">@RocketMQMessageListener</span><span style="color:#f92672">(</span>consumerGroup <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;consumer&#34;</span><span style="color:#f92672">,</span> topic <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;springboot-rocketmq-docker&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">implements</span> RocketMQListener<span style="color:#f92672">&lt;</span>MessageExt<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onMessage</span><span style="color:#f92672">(</span>MessageExt message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String msgId <span style="color:#f92672">=</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getMsgId</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">final</span> String msgBody <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(),</span> StandardCharsets<span style="color:#f92672">.</span><span style="color:#a6e22e">UTF_8</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">printf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Receive MsgId: %s MsgBody: %s%n&#34;</span><span style="color:#f92672">,</span> msgId<span style="color:#f92672">,</span> msgBody<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@SpringBootApplication</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>Consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>在模块目录下，创建 <code>src/main/resources/application.yml</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">rocketmq</span>:
  <span style="color:#66d9ef">name-server</span>: name-server:<span style="color:#ae81ff">9876</span>
</code></pre></div></li>
</ol>
<hr>
<h2 id="编写-dockerfile">编写 Dockerfile</h2>
<h3 id="创建-mq-producerdockerfile">创建 mq-producer/Dockerfile</h3>
<p>在模块 mq-producer 根目录下，创建 <code>Dockerfile</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk:8-jdk-alpine</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> JAR_FILE<span style="color:#f92672">=</span>target/*.jar<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /opt/app/</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./<span style="color:#e6db74">${</span>JAR_FILE<span style="color:#e6db74">}</span> producer.jar<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8080</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> java -jar producer.jar<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h3 id="创建-mq-consumerdockerfile">创建 mq-consumer/Dockerfile</h3>
<p>在模块 mq-consumer 根目录下，创建 <code>Dockerfile</code> 文件，并粘贴以下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk:8-jdk-alpine</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> JAR_FILE<span style="color:#f92672">=</span>target/*.jar<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /opt/app/</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./<span style="color:#e6db74">${</span>JAR_FILE<span style="color:#e6db74">}</span> consumer.jar<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> java -jar consumer.jar<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><hr>
<h2 id="编写-docker-composeyml">编写 docker-compose.yml</h2>
<h3 id="创建-docker-composeyml">创建 docker-compose.yml</h3>
<p>在工程根目录下，创建 <code>docker-compose.yml</code> 文件，并指定 Compose 文件格式的版本：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">version</span>: <span style="color:#e6db74">&#34;3.7&#34;</span>
</code></pre></div><h3 id="定义-network-springboot-rocketmq-docker">定义 network: springboot-rocketmq-docker</h3>
<p>在工程根目录的 <code>docker-compose.yml</code> 文件中，显式定义一个 network，用于连接后续定义的各个 Service：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">networks</span>:
  <span style="color:#66d9ef">springboot-rocketmq-docker</span>:
    <span style="color:#66d9ef">name</span>: springboot-rocketmq-docker
    <span style="color:#66d9ef">driver</span>: bridge
</code></pre></div><h3 id="定义-service-rocketmq-name-server">定义 service: rocketmq-name-server</h3>
<p>在工程根目录的 <code>docker-compose.yml</code> 文件中，定义 RocketMQ NameServer 的 Service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">name-server</span>:
    <span style="color:#66d9ef">image</span>: rocketmqinc/rocketmq:<span style="color:#ae81ff">4.4.0</span>
    <span style="color:#66d9ef">container_name</span>: rocketmq-name-server
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;9876:9876&#34;</span>
    <span style="color:#66d9ef">command</span>: sh mqnamesrv
    <span style="color:#66d9ef">networks</span>:
      - springboot-rocketmq-docker
</code></pre></div><h3 id="定义-service-rocketmq-broker-server">定义 service: rocketmq-broker-server</h3>
<p>在工程根目录的 <code>docker-compose.yml</code> 文件中，定义 RocketMQ BrokerServer 的 Service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">broker-server</span>:
    <span style="color:#66d9ef">image</span>: rocketmqinc/rocketmq:<span style="color:#ae81ff">4.4.0</span>
    <span style="color:#66d9ef">container_name</span>: rocketmq-broker-server
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;10909:10909&#34;</span>
      - <span style="color:#e6db74">&#34;10911:10911&#34;</span>
      - <span style="color:#e6db74">&#34;10912:10912&#34;</span>
    <span style="color:#66d9ef">command</span>: sh mqbroker -n name-server:<span style="color:#ae81ff">9876</span>
    <span style="color:#66d9ef">networks</span>:
      - springboot-rocketmq-docker
    <span style="color:#66d9ef">depends_on</span>:
      - name-server
</code></pre></div><h3 id="定义-service-springboot-mq-producer">定义 service: springboot-mq-producer</h3>
<p>在工程根目录的 <code>docker-compose.yml</code> 文件中，定义 mq-produce 模块的 Service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">producer</span>:
    <span style="color:#66d9ef">build</span>:
      <span style="color:#66d9ef">context</span>: ./mq-producer
    <span style="color:#66d9ef">image</span>: springboot-rocketmq-producer
    <span style="color:#66d9ef">container_name</span>: springboot-mq-producer
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;8080:8080&#34;</span>
    <span style="color:#66d9ef">networks</span>:
      - springboot-rocketmq-docker
    <span style="color:#66d9ef">depends_on</span>:
      - broker-server
</code></pre></div><h3 id="定义-service-springboot-mq-consumer">定义 service: springboot-mq-consumer</h3>
<p>在工程根目录的 <code>docker-compose.yml</code> 文件中，定义 mq-consumer 模块的 Service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">consumer</span>:
    <span style="color:#66d9ef">build</span>:
      <span style="color:#66d9ef">context</span>: ./mq-consumer
    <span style="color:#66d9ef">image</span>: springboot-rocketmq-consumer
    <span style="color:#66d9ef">container_name</span>: springboot-mq-consumer
    <span style="color:#66d9ef">networks</span>:
      - springboot-rocketmq-docker
    <span style="color:#66d9ef">depends_on</span>:
      - producer
</code></pre></div><hr>
<h2 id="打包项目构建和运行应用">打包项目，构建和运行应用</h2>
<h3 id="使用-maven-打包项目">使用 Maven 打包项目</h3>
<p>在工程根目录下，运行以下 Maven 命令，用于打包 mq-producer 和 mq-consumer 两个模块：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mvn clean package
</code></pre></div><h3 id="使用-docker-compose-构建和运行应用">使用 Docker Compose 构建和运行应用</h3>
<p>在工程根目录下，运行以下 Docker Compose 命令，用于启动应用：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker-compose up
</code></pre></div><p>也可以通过运行以下 Docker Compose 命令，用于以后台运行的方式启动应用，和列出正在运行的 Docker Service：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker-compose up -d
Creating rocketmq-name-server ... <span style="color:#66d9ef">done</span>
Creating rocketmq-broker-server ... <span style="color:#66d9ef">done</span>
Creating springboot-mq-producer ... <span style="color:#66d9ef">done</span>
Creating springboot-mq-consumer ... <span style="color:#66d9ef">done</span>
$ docker-compose ps
         Name                       Command               State                                           Ports
--------------------------------------------------------------------------------------------------------------------------------------------------------
rocketmq-broker-server   sh mqbroker -n name-server ...   Up      0.0.0.0:10909-&gt;10909/tcp, 0.0.0.0:10911-&gt;10911/tcp, 0.0.0.0:10912-&gt;10912/tcp, 9876/tcp
rocketmq-name-server     sh mqnamesrv                     Up      10909/tcp, 10911/tcp, 0.0.0.0:9876-&gt;9876/tcp
springboot-mq-consumer   /bin/sh -c java -jar consu ...   Up
springboot-mq-producer   /bin/sh -c java -jar produ ...   Up      0.0.0.0:8080-&gt;8080/tcp
</code></pre></div><hr>
<h2 id="预览效果">预览效果</h2>
<ol>
<li>
<p>通过 HTTP 协议，向作为 REST Server 的 MQ Producer 发送消息：</p>
<p><img src="https://raw.githubusercontent.com/FantasticMao/springboot-rocketmq-docker/master/doc/1.png" alt="image"></p>
</li>
<li>
<p>消息经由 RocketMQ 发送给 MQ Consumer 消费，并打印至控制台：</p>
<p><img src="https://raw.githubusercontent.com/FantasticMao/springboot-rocketmq-docker/master/doc/2.png" alt="image"></p>
</li>
</ol>
      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "fantasticmao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
          2016 -
        
        2020
         FantasticMao 
      
      
         · 
        技术支持 <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>
      
      
        · CDN
        <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">
          <img src="/images/upyun_logos/又拍云_logo5.png" style="width: 60px; margin-bottom: -8px"></img>
        </a>
      
      
    </section>
  </footer>


    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-89151446-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

  </body>

</html>
